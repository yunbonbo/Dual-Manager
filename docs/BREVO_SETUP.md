# Brevo メール送信 セットアップ手順（初めての方向け）

Vercel でメールが届くように Brevo を設定する手順です。所要時間は約 5 分です。

---

## ステップ 1: Brevo アカウント作成（約 2 分）

1. ブラウザで [https://www.brevo.com](https://www.brevo.com) を開く
2. 画面右上の **「無料で始める」** をクリック
3. 次の項目を入力：
   - **メールアドレス**: 管理者のメール（例: `yunbonbonbo@gmail.com`）
   - **パスワード**: 8文字以上で設定
4. **「アカウントを作成」** をクリック
5. 届いた認証メールのリンクをクリックしてメールアドレスを認証
6. ログイン後、初期設定の質問が出たら適宜答える（スキップ可能）

---

## ステップ 2: 送信元メールを認証（必須）

メールを送るには、**送信元として使うメールアドレスを Brevo で認証**する必要があります。

1. ログイン後、左上の **歯車アイコン**（設定）をクリック
2. 左メニューから **「送信元」**（Senders）をクリック
3. **「送信元を追加」** ボタンをクリック
4. 次の内容を入力：
   - **メールアドレス**: 送信元に使うアドレス（例: `yunbonbonbo@gmail.com`）
   - **送信元名**: 表示名（例: `予約システム`）
5. **「送信元を追加」** をクリック
6. **認証メールが届く** ので、そのメール内の **「認証する」** リンクをクリック
7. 認証が完了すると、送信元のステータスが「認証済み」になります

> ⚠️ この認証をしないとメールは送れません。必ず完了してください。

---

## ステップ 3: API キーを取得

1. 左上の **歯車アイコン**（設定）をクリック
2. 左メニューから **「API キー」**（SMTP & API）をクリック
3. **「API キーを生成」** をクリック
4. 次の内容を入力：
   - **名前**: 例 `Dual-Manager`
   - **権限**: 「メール送信」にチェック
5. **「生成」** をクリック
6. 表示された API キー（`xkeysib-` で始まる文字列）を **コピーして保存**

> ⚠️ このキーは一度しか表示されません。必ずコピーして安全な場所に保存してください。

---

## ステップ 4: 環境変数を設定

### ローカル開発の場合

プロジェクトの `.env` に以下を追加：

```bash
# Brevo
BREVO_API_KEY="xkeysib-ここにコピーしたAPIキーを貼り付け"
BREVO_SENDER_EMAIL="認証したメールアドレス@gmail.com"
BREVO_SENDER_NAME="予約システム"
NUXT_PUBLIC_EMAIL_ENABLED="true"
NUXT_PUBLIC_ADMIN_EMAIL="管理者のメールアドレス"
```

### Vercel の場合

1. [Vercel ダッシュボード](https://vercel.com/dashboard) を開く
2. 対象プロジェクトを選択
3. **Settings** → **Environment Variables** を開く
4. 次の変数を追加：

| Name | Value |
|------|-------|
| `BREVO_API_KEY` | ステップ 3 でコピーした API キー |
| `BREVO_SENDER_EMAIL` | ステップ 2 で認証したメールアドレス |
| `BREVO_SENDER_NAME` | `予約システム` |
| `NUXT_PUBLIC_EMAIL_ENABLED` | `true` |
| `NUXT_PUBLIC_ADMIN_EMAIL` | 管理者のメールアドレス |

5. **Save** をクリック
6. **Deployments** タブ → 最新デプロイの **⋯** → **Redeploy** で再デプロイ

---

## ステップ 5: 動作確認

### ローカルで確認する場合

```bash
npm run dev
```

ブラウザで次の URL を開く（メールアドレスは自分のものに変更）：

```
http://localhost:3000/api/email/test?to=あなたのメールアドレス
```

### Vercel で確認する場合

デプロイ後、次の URL を開く：

```
https://あなたのサイト.vercel.app/api/email/test?to=あなたのメールアドレス
```

テストメールが届けば成功です。届かない場合は **迷惑メールフォルダ** を確認してください。

---

## トラブルシューティング

| 症状 | 対処 |
|------|------|
| メールが届かない | 迷惑メールフォルダを確認。送信元の認証が完了しているか確認 |
| 「送信元が認証されていません」 | ステップ 2 の認証メール内リンクをクリックしたか確認 |
| API キーが分からない | ステップ 3 をやり直し。新しいキーを生成して再設定 |

---

## 無料枠

- **300通/日** 無料
- 小規模の予約システムなら十分です
